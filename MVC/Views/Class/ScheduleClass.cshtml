<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Creation Form</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Bebas+Neue&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        footer {
            display: none;
        }

        header {
            display: none;
        }

        :root {
            --background: #1a1a2e;
            --color: #ffffff;
            --primary-color: #ff4d4d;
            --glass-color: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: "Poppins", sans-serif;
            background: var(--background);
            color: var(--color);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #city[readonly] {
            background-color: rgba(255, 255, 255, 0.1) !important;
            opacity: 1 !important;
            cursor: default !important;
        }


        .container {
            padding: 1rem;
        }

        .form-container {
            border: 1px solid hsla(0, 0%, 65%, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            backdrop-filter: blur(15px);
            background: var(--glass-color);
            padding: 2.5rem;
            max-width: 900px;
            width: 100%;
        }

        h1 {
            font-family: "Bebas Neue", sans-serif;
            font-size: 3rem;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .tagline {
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 1.5rem;
            font-style: italic;
            opacity: 0.7;
        }

        .section {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 1rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-family: "Bebas Neue", sans-serif;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .form-label {
            color: var(--color);
            font-weight: 500;
        }

        .form-control,
        .form-select {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--color);
            border-radius: 8px;
            padding: 14px;
            transition: all 0.3s ease;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.2);
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--color);
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .btn {
            background-color: var(--primary-color);
            color: var(--color);
            padding: 14px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            border: none;
            transition: all 0.3s ease;
        }

        .btn:hover {
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
            transform: scale(1.03);
        }

        .custom-datepicker {
            background-color: var(--glass-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--color);
            position: relative;
        }

        /* Image Preview Layout */
        #imagePreview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) rgba(255, 255, 255, 0.1);
        }

        #imagePreview::-webkit-scrollbar {
            width: 6px;
        }

        #imagePreview::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        #imagePreview::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        .image-preview-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1;
            text-align: center;
            margin: 0;
        }

        .image-preview-item {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .remove-btn:hover {
            background-color: rgba(255, 0, 0, 0.9);
            transform: scale(1.1);
        }

        #classDescription {
            height: 120px;
            min-height: 180px;
            max-height: 120px;
            resize: none;
        }

        /* Drop Zone */
        .drop-zone {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.05);
        }

        .drop-zone:hover {
            border-color: var(--primary-color);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .drop-zone.drag-over {
            border-color: var(--primary-color);
            background-color: rgba(0, 196, 180, 0.1);
        }

        #dropText {
            margin: 0;
            color: var(--color);
            opacity: 0.7;
        }

        /* Section Heights */
        .section {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
        }

        .form-container {
            display: flex;
            flex-direction: column;
        }

        .row {
            flex: 1;
            display: flex;
        }

        .col-md-6 {
            display: flex;
            flex-direction: column;
        }

        /* Media Section Adjustments */
        .section.mb-4:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
        }

        #classDescription {
            height: 120px;
            min-height: 180px;
            max-height: 120px;
            resize: none;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) rgba(255, 255, 255, 0.1);
        }

        #classDescription::-webkit-scrollbar {
            width: 6px;
        }

        #classDescription::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        #classDescription::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 3px;
        }



        /* Ensure both columns have equal height */
        @@media (min-width: 768px) {
            .row>.col-md-6 {
                min-height: 0;
                flex: 1;
            }
        }

        .invalid-feedback {
            color: #ff6b6b;
            font-size: 0.85rem;
        }

        .is-invalid {
            border-color: #ff6b6b !important;
        }

        .fee-container {
            position: relative;
        }

        .fee-container::before {
            content: '$';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color);
            z-index: 1;
        }

        .fee-input {
            padding-left: 30px !important;
        }

        .upload-box {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .upload-box:hover {
            border-color: var(--primary-color);
        }

        .image-filename {
            margin-top: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
        }

        /* Enhanced Dropdown Styling */
        .form-select {
            appearance: none;
            /* Remove default browser styling */
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: var(--color);
            border-radius: 10px;
            padding: 12px 40px 12px 15px;
            /* More padding, space for custom arrow */
            font-size: 16px;
            transition: all 0.3s ease;
            position: relative;
            outline: none;
            background-image: linear-gradient(45deg, transparent 50%, var(--primary-color) 50%),
                linear-gradient(135deg, var(--primary-color) 50%, transparent 50%);
            background-position: calc(100% - 20px) calc(1em + 2px),
                calc(100% - 15px) calc(1em + 2px);
            background-size: 5px 5px,
                5px 5px;
            background-repeat: no-repeat;
        }

        .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.2);
            background-color: rgba(255, 255, 255, 0.15);
        }

        .form-select option {
            background-color: var(--background);
            color: var(--color);
            padding: 10px;
        }

        .form-select option:checked {
            background-color: var(--primary-color);
            color: var(--background);
        }

        /* Placeholder-like first option styling */
        .form-select option[disabled] {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Equipment Multiselect Styling */
        .dropdown-menu {
            background-color: var(--background);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .dropdown-item {
            color: var(--color);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dropdown-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--primary-color);
        }

        .dropdown-item input[type="checkbox"] {
            margin-right: 0.5rem;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            background-color: transparent;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .dropdown-item input[type="checkbox"]:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .dropdown-item input[type="checkbox"]:checked::after {
            content: 'âœ“';
            position: absolute;
            color: var(--background);
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }


        /* Selected Equipment Display */
        #selectedEquipment {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 0.9rem;
            color: var(--color);
            max-height: 100px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) rgba(255, 255, 255, 0.1);
        }

        #selectedEquipment::-webkit-scrollbar {
            width: 6px;
        }

        #selectedEquipment::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        #selectedEquipment::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        .selected-equipment-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .selected-equipment-item {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.25rem;
            transition: all 0.3s ease;
        }

        .selected-equipment-item:hover {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: var(--primary-color);
        }

        .equipment-remove-btn {
            background: none;
            border: none;
            color: var(--color);
            cursor: pointer;
            padding: 0;
            font-size: 1.1rem;
            line-height: 1;
            opacity: 0.7;
            transition: all 0.3s ease;
        }

        .equipment-remove-btn:hover {
            opacity: 1;
            color: #ff6b6b;
        }

        /* Equipment Dropdown Button */
        #equipmentDropdown {
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: var(--color);
            border-radius: 10px;
            padding: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            text-align: left;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dropdown-menu {
            max-height: 200px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) rgba(255, 255, 255, 0.1);
        }

        .dropdown-menu::-webkit-scrollbar {
            width: 6px;
        }

        .dropdown-menu::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .dropdown-menu::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        /* Date Range Validation Styling */
        .date-range-error {
            color: #ff6b6b;
            font-size: 0.85rem;
            margin-top: 0.25rem;
            display: none;
        }

        .is-invalid+.date-range-error {
            display: block;
        }

        /* Time Range Validation Styling */
        .time-range-error {
            color: #ff6b6b;
            font-size: 0.85rem;
            margin-top: 0.25rem;
            display: none;
        }

        .is-invalid+.time-range-error {
            display: block;
        }


        /* Class Description Textarea Styling */
        #classDescription {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--color);
            border-radius: 8px;
            padding: 14px;
            font-size: 1rem;
            line-height: 1.5;
            transition: all 0.3s ease;
            min-height: 120px;
            resize: none;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) rgba(255, 255, 255, 0.1);
        }

        #classDescription:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 16px rgba(0, 0, 0, 0.2);
            background-color: rgba(255, 255, 255, 0.15);
            outline: none;
        }

        #classDescription::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        #classDescription::-webkit-scrollbar {
            width: 6px;
        }

        #classDescription::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        #classDescription::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 3px;
        }



        .btn {
            background-color: #28a745;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            border-color: #28a745;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
            margin-top: 10px;
        }

        .btn:hover {
            background-color: #218838;
            border-color: #1e7e34;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }

        .section-indicator {
            display: flex;
            margin-bottom: 15px;
            justify-content: space-between;
        }

        #selectedEquipment {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            min-height: 40px;
        }

        .selected-equipment-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .selected-equipment-item {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .equipment-remove-btn {
            background: none;
            border: none;
            color: var(--color);
            cursor: pointer;
            padding: 0;
            font-size: 1.1rem;
            line-height: 1;
        }

        .selected-equipment-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .selected-equipment-item {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .equipment-remove-btn {
            background: none;
            border: none;
            color: var(--color);
            cursor: pointer;
            padding: 0;
            font-size: 1.1rem;
            line-height: 1;
            opacity: 0.7;
            transition: all 0.3s ease;
        }

        .equipment-remove-btn:hover {
            opacity: 1;
            color: #ff6b6b;
        }

        /* SweetAlert2 Styles (Updated from first CSS) */
        .swal2-popup {
            background: var(--glass-color) !important;
            backdrop-filter: blur(15px) !important;
            border: 1px solid hsla(0, 0%, 65%, 0.2) !important;
            border-radius: 15px !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3) !important;
            color: var(--color) !important;
        }

        .swal2-title {
            color: var(--color) !important;
            font-family: "Poppins", sans-serif !important;
            letter-spacing: 1px !important;
        }

        .swal2-content {
            color: rgba(255, 255, 255, 0.8) !important;
            font-family: "Poppins", sans-serif !important;
        }

        .swal2-confirm {
            background-color: var(--success-color) !important;
            color: var(--color) !important;
            border: none !important;
            border-radius: 8px !important;
            font-family: "Poppins", sans-serif !important;
            transition: all 0.3s ease !important;
        }

        .swal2-confirm:hover {
            background-color: #218838 !important;
            transform: scale(1.03) !important;
        }

        .swal2-cancel {
            background-color: rgba(255, 255, 255, 0.1) !important;
            color: var(--color) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 8px !important;
            font-family: "Poppins", sans-serif !important;
            transition: all 0.3s ease !important;
        }

        .swal2-cancel:hover {
            background-color: rgba(255, 255, 255, 0.2) !important;
            transform: scale(1.03) !important;
        }

        .swal2-icon.swal2-warning {
            color: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
        }

        .swal2-icon.swal2-success {
            border-color: var(--success-color) !important;
            background: none !important;
        }

        .swal2-icon.swal2-success .swal2-success-ring {
            border-color: var(--success-color) !important;
            background: none !important;
            display: block !important;
        }

        .swal2-icon.swal2-success .swal2-success-circular-line-left,
        .swal2-icon.swal2-success .swal2-success-circular-line-right,
        .swal2-icon.swal2-success .swal2-success-fix {
            display: none !important;
        }

        .swal2-icon.swal2-success .swal2-success-ring::before,
        .swal2-icon.swal2-success .swal2-success-ring::after {
            display: none !important;
            background: transparent !important;
        }

        .swal2-icon.swal2-success::before,
        .swal2-icon.swal2-success::after {
            display: none !important;
            background: transparent !important;
        }

        .swal2-icon.swal2-success [class^='swal2-success-line'] {
            background-color: var(--success-color) !important;
        }
    </style>
</head>

<body>
    <div class="modal fade" id="mapModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header">
                    <h5 class="modal-title">Select Location</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="map" style="height: 400px;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmLocationBtn">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="form-container">
            <h1>Create a Class</h1>
            <p class="tagline">Fill in the details to schedule your class</p>
            <form id="classForm" novalidate>
                <div class="row">
                    <!-- Left Column -->
                    <div class="col-md-6">
                        <div class="section mb-4">
                            <h2 class="section-title">Basic Information</h2>
                            <div class="mb-3">
                                <label for="className" class="form-label">Class Title</label>
                                <input type="text" class="form-control" id="className" placeholder="e.g., Yoga Basics"
                                    required minlength="2" maxlength="100">
                                <div class="invalid-feedback">Class name must be between 2 and 100 characters</div>
                            </div>



                            <div class="mb-3">
                                <label for="classDescription" class="form-label">Describe Your Class Purpose</label>

                                <div class="textarea-container">
                                    <textarea class="form-control" id="classDescription" rows="5"
                                        placeholder="Click here to start writing your class description..."
                                        required></textarea>
                                    <div class="invalid-feedback">Description is required.</div>

                                </div>


                            </div>

                            <div class="mb-3">
                                <label for="classDescription" class="form-label">Describe Your Class Purpose</label>

                                <div class="textarea-container">
                                    <textarea class="form-control" id="classBenefits" rows="5"
                                        placeholder="Click here to start writing your class description..."
                                        required></textarea>
                                    <div class="invalid-feedback">Benefits description is required.</div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="classType" class="form-label">Class Type</label>
                                <select class="form-select" id="classType" required>
                                    <option value="" disabled selected>Select class type...</option>
                                </select>
                                <div class="invalid-feedback">Please select a class type</div>
                            </div>
                            <div class="mb-3 fee-container">
                                <label for="fee" class="form-label">Class Fee</label>
                                <input type="number" class="form-control fee-input" id="fee" min="0" max="100000"
                                    step="0.01" placeholder="0.00" required>
                                <div class="invalid-feedback">Fee must be between $0 and $100,000</div>
                            </div>
                        </div>

                        <div class="section mb-4">
                            <h2 class="section-title">Class Details</h2>
                            <div class="mb-3">
                                <label for="maxCapacity" class="form-label">Max Capacity</label>
                                <input type="number" class="form-control" id="maxCapacity" min="1" max="1000"
                                    placeholder="e.g., 20" required>
                                <div class="invalid-feedback">Capacity must be between 1 and 1000</div>
                            </div>

                            <div class="mb-3 equipment-dropdown">
                                <label class="form-label">Required Equipment</label>
                                <div class="dropdown">
                                    <button
                                        class="btn form-control dropdown-toggle d-flex justify-content-between align-items-center"
                                        type="button" id="equipmentDropdown" data-bs-toggle="dropdown"
                                        aria-expanded="false">
                                        <span id="equipmentDropdownText">Select equipment...</span>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="equipmentDropdown">
                                        <!-- Will be populated by JavaScript -->
                                    </ul>
                                </div>

                                <div id="selectedEquipment" class="mt-2"></div>
                            </div>
                            @* <div class="invalid-feedback">Equipment is required.</div> *@

                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="section mb-4">
                            <h2 class="section-title">Schedule</h2>
                            <div class="row mb-3">
                                <div class="col-6">
                                    <label for="startDate" class="form-label">Start Date</label>
                                    <input type="date" class="form-control custom-datepicker" id="startDate" required>
                                    <div class="invalid-feedback">Start date is required
                                    </div>
                                </div>
                                <div class="col-6">
                                    <label for="endDate" class="form-label">End Date</label>
                                    <input type="date" class="form-control custom-datepicker" id="endDate" required>
                                    <div class="invalid-feedback">End Date is required</div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-6">
                                    <label for="startTime" class="form-label">Start Time</label>
                                    <input type="time" class="form-control" id="startTime" required>
                                    <div class="invalid-feedback">Start time is required</div>
                                </div>
                                <div class="col-6">
                                    <label for="endTime" class="form-label">End Time</label>
                                    <input type="time" class="form-control" id="endTime" required>
                                    <div class="invalid-feedback">End time is required</div>
                                </div>
                            </div>
                        </div>

                        <div class="section mb-4">
                            <h2 class="section-title">Location</h2>
                            <div class="mb-3">
                                <label for="address" class="form-label">Address</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="address"
                                        placeholder="Select Address From Map" required
                                        style="border-top-right-radius: 0; border-bottom-right-radius: 20px;">

                                    <button
                                        class="btn btn-outline-secondary d-flex align-items-center justify-content-center"
                                        type="button" id="openMapBtn" style="height:50px; width: 42px; padding: 0; border-left: none;
                                        border-top-left-radius: 0; border-bottom-left-radius: 0;">
                                        <i class="bi bi-geo-alt-fill">ðŸ“Œ</i>
                                    </button>
                                    <div class="invalid-feedback">Please select an address using the map</div>

                                </div>

                            </div>
                            <div class="mb-3">
                                <label for="city" class="form-label">City</label>
                                <input type="text" class="form-control" id="city" list="cityList" placeholder="City"
                                    required maxlength="50" readonly>
                                <datalist id="cityList">
                                    <option value="New York"></option>
                                    <option value="Los Angeles"></option>
                                    <option value="Chicago"></option>
                                    <option value="Houston"></option>
                                    <option value="Miami"></option>
                                </datalist>
                                <div class="invalid-feedback">City is required (max 50 characters)</div>
                            </div>
                        </div>

                        <div class="section mb-4">
                            <h2 class="section-title">Media</h2>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Upload Images</label>
                                <label>Class Assets (Images)</label>
                                <div id="dropZone" class="drop-zone">
                                    <input type="file" id="imageInput" multiple accept="image/*" style="display:none;">
                                    <p id="dropText">Drag and drop images or click to select</p>
                                </div>

                                <div id="imagePreview"></div>
                                <div class="invalid-feedback"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <input type="hidden" id="instructorId" value="1">
                <input type="hidden" id="status" value="Active">

                <button type="submit" class="btn">Create Class</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        document.addEventListener("DOMContentLoaded", function () {

            var equippments = "";

            localStorage.setItem(
                "authToken",
                "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJKV1RTZXJ2aWNlc0FjY2Vzc1Rva2VuIiwianRpIjoiMzRkNTk1M2QtOTg4Mi00ZGRkLWEwZTUtMDcwMWVmMmEyYmE0IiwiVXNlck9iamVjdCI6IntcImluc3RydWN0b3JJZFwiOjEwLFwiaW5zdHJ1Y3Rvck5hbWVcIjpcIktodXNoaVwiLFwiZW1haWxcIjpcImtodXNoaTFAZ21haWwuY29tXCIsXCJwYXNzd29yZFwiOm51bGwsXCJjb25maXJtUGFzc3dvcmRcIjpudWxsLFwibW9iaWxlXCI6XCIxMTExMTExMTExXCIsXCJnZW5kZXJcIjpcIkZlbWFsZVwiLFwiZG9iXCI6XCIyMDAzLTA4LTIxVDAwOjAwOjAwXCIsXCJzcGVjaWFsaXphdGlvblwiOlwiWW9nYSxHeW0sWnVtYmEsQm94aW5nLEN5Y2xpbmdcIixcImNlcnRpZmljYXRlc1wiOntcIllvZ2FcIjpcImtodXNoaTFAZ21haWwuY29tX1lvZ2FfNjkzYWJhOTEtM2ZkMi00YzBkLWIwMTEtNWIwM2I4YzM4ZGJlLmpwZ1wifSxcInByb2ZpbGVJbWFnZVwiOlwiMDJkZmFjMzgtNDAwZC00N2I4LTk3ZWUtNDg3MjBjZTIyMGVkLnBuZ1wiLFwiYXNzb2NpYXRpb25cIjpcIkZpdFByb1wiLFwiY3JlYXRlZEF0XCI6XCIyMDI1LTAzLTI2VDEzOjEyOjU3LjkyMjc5NFwiLFwic3RhdHVzXCI6XCJBcHByb3ZlXCIsXCJpZFByb29mXCI6XCJraHVzaGkxQGdtYWlsLmNvbV9pZHByb29mLnBuZ1wiLFwiYWN0aXZhdGlvblRva2VuXCI6XCJkNmY3MGI1MC0yMmQ0LTQzYjYtODlhMy1iNWYxYzJmMzllNWFcIixcImFjdGl2YXRlZE9uXCI6XCIyMDI1LTAzLTI1VDE2OjI0OjM4LjA1NzA2OVwiLFwiaWRQcm9vZkZpbGVcIjpudWxsLFwiY2VydGlmaWNhdGVGaWxlc1wiOm51bGwsXCJwcm9maWxlSW1hZ2VGaWxlXCI6bnVsbH0iLCJleHAiOjE3NDM1NzUyMTUsImlzcyI6Imh0dHBzOi8vbG9jYWxob3N0OjgwODAiLCJhdWQiOiJodHRwczovL2xvY2FsaG9zdDo4MDgxIn0.skvlvLeHwinaCrDNsXyHr7EDC1crFYPzGB7mFrII_hQ"
            );

            function getUserIdFromToken() {
                const token = localStorage.getItem("authToken");
                if (!token) {
                    console.warn("No auth token found in localStorage.");
                    return null;
                }
                const decoded = parseJwt(token);
                if (decoded) {
                    console.log("this is line 144 decoded:" + JSON.parse(decoded.UserObject).instructorName);
                    console.log("this is line 144 decoded:" + JSON.parse(decoded.UserObject).specialization);


                    return JSON.parse(decoded.UserObject).instructorId;
                }
                console.warn("Invalid or malformed token.");
                return null;
            }

            function parseJwt(token) {
                try {
                    const base64Url = token.split(".")[1];
                    const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
                    return JSON.parse(atob(base64));
                } catch (error) {
                    console.error("Invalid token:", error);
                    return null;
                }
            }

            getUserIdFromToken();


            fetchClassTypesFromAPI();

            const addressInput = document.getElementById("address");
            const openMapBtn = document.getElementById("openMapBtn");
            const mapModal = new bootstrap.Modal(document.getElementById("mapModal"));
            let map, marker;

            //Get Instructor Specialization From Token (All Specialization = Class Type)
            function getInstructorSpecializations() {
                const token = localStorage.getItem("authToken");
                if (!token) {
                    console.warn("No auth token found in localStorage.");
                    return [];
                }

                const decoded = parseJwt(token);
                if (decoded && decoded.UserObject) {
                    const userObject = JSON.parse(decoded.UserObject);
                    if (userObject.specialization) {
                        return userObject.specialization.split(',').map(spec => spec.trim());
                    }
                }

                console.warn("No specializations found in token.");
                return [];
            }

            function parseJwt(token) {
                try {
                    const base64Url = token.split(".")[1];
                    const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
                    return JSON.parse(atob(base64));
                } catch (error) {
                    console.error("Invalid token:", error);
                    return null;
                }
            }

            //Here We Create Class Types 
            function createClassTypesFromSpecializations() {
                const specializations = getInstructorSpecializations();
                console.log("Instructor specializations:", specializations);

                if (specializations.length === 0) {
                    console.warn("No specializations found.");
                    return [];
                }

                return specializations.map((specialization, index) => ({
                    id: index + 1,
                    name: specialization
                }));
            }

            //Fetch Class Types and show on DropDown
            function fetchClassTypesFromAPI() {
                const classTypes = createClassTypesFromSpecializations();

                if (classTypes.length === 0) {
                    console.warn("No class types available to populate.");
                    return;
                }

                const $classTypeDropdown = $('#classType');
                $classTypeDropdown.empty();

                // Add a placeholder option
                $classTypeDropdown.append(
                    $('<option>', {
                        value: '',
                        text: 'Select class type...',
                        disabled: true,
                        selected: true
                    })
                );

                // Populate the dropdown with class types
                classTypes.forEach(classType => {
                    $classTypeDropdown.append(
                        $('<option>', {
                            value: classType.name, // Use class name as the value
                            text: classType.name
                        })
                    );
                });

                console.log('Class types populated:', classTypes);
            }


            //Eqippments(static) Based On The Class Type
            const equipmentByClassType = {
                "Yoga": [
                    { value: 'Yoga Mat', icon: 'ðŸ§˜', description: 'Essential for yoga and floor exercises' },
                    { value: 'Yoga Blocks', icon: 'ðŸŸ«', description: 'Support for deeper poses' },
                    { value: 'Resistance Bands', icon: 'ðŸ”„', description: 'For strength and flexibility training' },
                    { value: 'Exercise Ball', icon: 'âš½', description: 'For balance and core exercises' },
                    { value: 'Dumbbells', icon: 'ðŸ‹ï¸', description: 'Strength training weights' },
                    { value: 'Barbells', icon: 'ðŸ’ª', description: 'Heavyweight lifting' },
                    { value: 'Kettlebells', icon: 'ðŸ‹ï¸â€â™‚ï¸', description: 'Functional strength training' },
                    { value: 'Treadmill', icon: 'ðŸƒ', description: 'For cardiovascular exercise' }
                ],
                "Gym": [
                    { value: 'Dumbbells', icon: 'ðŸ‹ï¸', description: 'Strength training weights' },
                    { value: 'Barbells', icon: 'ðŸ’ª', description: 'Heavyweight lifting' },
                    { value: 'Kettlebells', icon: 'ðŸ‹ï¸â€â™‚ï¸', description: 'Functional strength training' },
                    { value: 'Treadmill', icon: 'ðŸƒ', description: 'For cardiovascular exercise' }
                ],
                "Zumba": [
                    { value: 'Dance Sneakers', icon: 'ðŸ‘Ÿ', description: 'Comfortable footwear for Zumba' },
                    { value: 'Light Dumbbells', icon: 'ðŸŽ½', description: 'For adding intensity' },
                    { value: 'Resistance Bands', icon: 'ðŸŒ€', description: 'For muscle toning' },
                    { value: 'Aerobic Step', icon: 'ðŸ“¶', description: 'For high-energy moves' }
                ],
                "Boxing": [
                    { value: 'Boxing Gloves', icon: 'ðŸ¥Š', description: 'Essential for boxing training' },
                    { value: 'Punching Bag', icon: 'ðŸŽ¯', description: 'For practicing punches' },
                    { value: 'Hand Wraps', icon: 'ðŸ©¹', description: 'Protects hands and wrists' },
                    { value: 'Speed Rope', icon: 'â³', description: 'Improves footwork and agility' }
                ],
                "Cycling": [
                    { value: 'Stationary Bike', icon: 'ðŸš´', description: 'For indoor cycling' },
                    { value: 'Cycling Shoes', icon: 'ðŸ‘Ÿ', description: 'Enhances pedal efficiency' },
                    { value: 'Heart Rate Monitor', icon: 'â¤ï¸', description: 'Tracks workout intensity' },
                    { value: 'Resistance Bands', icon: 'ðŸŒ€', description: 'For off-bike workouts' }
                ],
                "CrossFit": [
                    { value: 'Kettlebells', icon: 'ðŸ‹ï¸â€â™€ï¸', description: 'For functional training' },
                    { value: 'Plyo Box', icon: 'ðŸ“¦', description: 'For explosive jump training' },
                    { value: 'Medicine Ball', icon: 'âš¾', description: 'For strength and conditioning' },
                    { value: 'Battle Ropes', icon: 'ðŸª¢', description: 'For endurance workouts' }
                ],
                "Pilates": [
                    { value: 'Pilates Reformer', icon: 'ðŸ›ï¸', description: 'Enhances core workouts' },
                    { value: 'Stability Ball', icon: 'ðŸŽ±', description: 'For balance and control' },
                    { value: 'Foam Roller', icon: 'ðŸ”µ', description: 'For muscle recovery' },
                    { value: 'Resistance Ring', icon: 'â­•', description: 'For toning exercises' }
                ],

                "Kickboxing": [
                    { value: 'Kickboxing Gloves', icon: 'ðŸ¥‹', description: 'Protects hands during training' },
                    { value: 'Thai Pads', icon: 'ðŸ›¡ï¸', description: 'For kick drills' },
                    { value: 'Heavy Bag', icon: 'ðŸ‘œ', description: 'For striking practice' },
                    { value: 'Agility Ladder', icon: 'ðŸ', description: 'For footwork training' }
                ],
                "Strength Training": [
                    { value: 'Power Rack', icon: 'ðŸ—ï¸', description: 'For barbell exercises' },
                    { value: 'Adjustable Dumbbells', icon: 'âš–ï¸', description: 'Versatile strength training' },
                    { value: 'Bench Press', icon: 'ðŸ›ï¸', description: 'For upper body workouts' },
                    { value: 'Weighted Vest', icon: 'ðŸŽ½', description: 'Adds resistance to bodyweight exercises' }
                ]
            };

            console.log(equipmentByClassType);


            const equipmentDropdown = document.getElementById('equipmentDropdown');
            const equipmentMenu = document.querySelector('.equipment-dropdown .dropdown-menu');
            const selectedEquipmentContainer = document.getElementById('selectedEquipment');
            let selectedEquipment = [];

            $('.equipment-dropdown .dropdown-menu input[type="checkbox"]').on('change', function () {
                const itemValue = $(this).val();
                if ($(this).is(':checked')) {
                    // Find the equipment object and add it
                    const classType = $('#classType').val();
                    const equipmentItem = equipmentByClassType[classType].find(item => item.value === itemValue);
                    if (equipmentItem) {
                        selectedEquipment.push(equipmentItem);
                    }
                } else {
                    selectedEquipment = selectedEquipment.filter(item => item.value !== itemValue);
                }
                updateSelectedEquipmentDisplay();
                // validateEquipment(); // Add this line to validate in real-time
            });

            function validateEquipment() {
                const $equipmentDropdown = $('.equipment-dropdown');
                const $feedbackElement = $equipmentDropdown.find('.invalid-feedback');

                // Ensure feedback element exists
                if ($feedbackElement.length === 0) {
                    $equipmentDropdown.append('<div class="invalid-feedback">Please select at least one equipment item</div>');
                }

                // Check if any equipment is selected
                if (selectedEquipment.length === 0) {
                    $equipmentDropdown.addClass('is-invalid');
                    $equipmentDropdown.find('.invalid-feedback').text('Please select at least one equipment item').show();
                    return false;
                }

                // Check if equipment matches the class type
                const classType = $('#classType').val();
                if (!classType || !equipmentByClassType[classType]) {
                    $equipmentDropdown.addClass('is-invalid');
                    $equipmentDropdown.find('.invalid-feedback').text('Please select a valid class type first').show();
                    return false;
                }

                // Validate each selected equipment belongs to the current class type
                const validEquipment = selectedEquipment.every(item =>
                    equipmentByClassType[classType].some(validItem => validItem.value === item.value)
                );

                if (!validEquipment) {
                    $equipmentDropdown.addClass('is-invalid');
                    $equipmentDropdown.find('.invalid-feedback').text('Some selected equipment is not valid for this class type').show();
                    return false;
                }

                // **Fix: Remove the error class and hide the feedback message**
                $equipmentDropdown.removeClass('is-invalid');
                $feedbackElement.hide();  // Hide error message when valid

                return true;
            }




            //Here We Update Selected Equippment
            function updateSelectedEquipmentDisplay() {
                const $dropdownText = $('#equipmentDropdownText');
                const $selectedEquipmentContainer = $('#selectedEquipment');

                if (selectedEquipment.length === 0) {
                    $dropdownText.text('Select equipment...');
                    $selectedEquipmentContainer.html('<span class="text-muted">No equipment selected</span>');
                    return;
                }

                $dropdownText.text(selectedEquipment.length === 1 ? selectedEquipment[0].value : `${selectedEquipment.length} items selected`);

                const $list = $('<ul>').addClass('selected-equipment-list');
                selectedEquipment.forEach(item => {
                    const $listItem = $('<li>').addClass('selected-equipment-item').text(item.value);
                    const $removeBtn = $('<button>').addClass('equipment-remove-btn').html('&times;');

                    $removeBtn.on('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        unselectEquipment(item.value);
                    });

                    $listItem.prepend($removeBtn);
                    $list.append($listItem);
                });

                $selectedEquipmentContainer.empty().append($list);
            }

            function unselectEquipment(value) {
                const $checkbox = $(`.equipment-dropdown .dropdown-menu input[value="${value}"]`);
                if ($checkbox.length) {
                    $checkbox.prop('checked', false);
                }
                selectedEquipment = selectedEquipment.filter(item => item.value !== value);
                console.log("Selected Equipment (After Remove):", selectedEquipment);
                updateSelectedEquipmentDisplay();
            }

            function populateEquipmentDropdown(classType) {
                const $equipmentMenu = $('.equipment-dropdown .dropdown-menu');
                $equipmentMenu.empty();
                selectedEquipment = [];

                if (!classType || !equipmentByClassType[classType]) {
                    updateSelectedEquipmentDisplay();
                    return;
                }

                equipmentByClassType[classType].forEach(item => {
                    const $listItem = $('<li>');
                    const $label = $('<label>').addClass('dropdown-item d-flex align-items-center');
                    const $checkbox = $('<input>').attr({ type: 'checkbox', value: item.value }).addClass('form-check-input me-2');

                    $checkbox.on('change', function () {
                        if ($(this).is(':checked')) {
                            selectedEquipment.push(item);
                        } else {
                            selectedEquipment = selectedEquipment.filter(equip => equip.value !== item.value);
                        }
                        updateSelectedEquipmentDisplay();
                    });

                    $label.append($checkbox).append(`${item.icon} ${item.value}`);
                    $listItem.append($label);
                    $equipmentMenu.append($listItem);
                });

                updateSelectedEquipmentDisplay();
            }

            $('#classType').on('change', function () {
                populateEquipmentDropdown($(this).val());

            });

            const style = document.createElement('style');
            style.textContent = `
            .equipment-dropdown.is-invalid .dropdown-toggle {
                border-color: #dc3545;
            }
            
            .equipment-dropdown.is-invalid .invalid-feedback {
                display: block;
                color: #dc3545;
                font-size: 0.875em;
                margin-top: 0.25rem;
            }
        `;
            document.head.appendChild(style);

            //Map For Address
            document.getElementById("mapModal").addEventListener("shown.bs.modal", function () {

                if (!map) {
                    map = L.map('map').setView([0, 0], 2);
                    L.tileLayer('https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.png', {
                        attribution: 'Â© <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> Â© <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    }).addTo(map);

                    map.on('click', async (e) => {
                        if (marker) map.removeLayer(marker);
                        marker = L.marker(e.latlng).addTo(map);
                        await fetchAddress(e.latlng.lat, e.latlng.lng);
                    });
                }

                //Live Location Fetch 
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (pos) => {
                            const { latitude, longitude } = pos.coords;
                            map.setView([latitude, longitude], 15);
                            if (marker) map.removeLayer(marker);
                            marker = L.marker([latitude, longitude]).addTo(map);
                            fetchAddress(latitude, longitude);
                        },
                        (error) => {
                            console.log("Geolocation error:", error);
                        }
                    );
                }
            });


            //Fetch Address From The Map (Select)
            async function fetchAddress(lat, lng) {
                try {
                    //here only english lang accept
                    const response = await fetch(
                        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=en`
                    );

                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log("Nominatim API Response:", data); // Debugging

                    if (!data || !data.address) {
                        throw new Error("Invalid address data received");
                    }

                    // Extract the address
                    const englishAddress = data.display_name || `Near ${data.address.road || data.address.city || 'Selected Location'}`;
                    document.getElementById("address").value = englishAddress;

                    // Extract city
                    const city = data.address.city || data.address.town || data.address.village || data.address.state_district || data.address.state || "";

                    if (city) {
                        document.getElementById("city").value = city;
                    } else {
                        document.getElementById("city").value = "Unknown City";
                    }

                } catch (error) {
                    console.error("Error fetching address:", error);
                    document.getElementById("address").value = `Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`;
                    document.getElementById("city").value = "Unknown City";
                }
            }

            //City Field is only read only
            document.getElementById("city").readOnly = true;


            openMapBtn.addEventListener("click", () => mapModal.show());
            document.getElementById("confirmLocationBtn").addEventListener("click", () => mapModal.hide());

            const form = document.getElementById("classForm");
            @* const equipmentDropdown = document.getElementById("equipmentDropdown"); *@
            const selectedEquipmentDiv = document.getElementById("selectedEquipment");
            const startDateInput = document.getElementById("startDate");
            const endDateInput = document.getElementById("endDate");
            const startTimeInput = document.getElementById("startTime");
            const endTimeInput = document.getElementById("endTime");
            const maxCapacityInput = document.getElementById("maxCapacity");
            const availableCapacityInput = document.getElementById("availableCapacity");



            let selectedFiles = [];
            let imageAssets = {};
            const today = new Date().toISOString().split('T')[0];
            startDateInput.min = today;

            const checkboxes = document.querySelectorAll('input[name="equipment"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener("change", updateSelectedEquipment);
            });

            @* function updateSelectedEquipment() {
                const selected = Array.from(checkboxes)
                    .filter(cb => cb.checked)
                    .map(cb => cb.value);
                equipmentDropdown.textContent = selected.length > 0 ? selected.join(", ") : "Select equipment...";
                selectedEquipmentDiv.textContent = selected.length > 0 ? `Selected: ${selected.join(", ")}` : "";
            } *@

            // Drag And Drop 
            const dropZone = document.getElementById('dropZone');
            const imageInput = document.getElementById('imageInput');
            const imagePreview = document.getElementById('imagePreview');
            const dropText = document.getElementById('dropText');

            const MAX_IMAGES = 6;
            const BANNER_DIMENSIONS = { width: 1920, height: 1080 }; // Banner dimensions
            const NORMAL_MAX_SIZE = 2 * 1024 * 1024; // 2MB for normal images
            const BANNER_MAX_SIZE = 5 * 1024 * 1024; // 5MB for banner image

            let hasBannerImage = false;

            function initializeDragAndDrop() {
                if (!dropZone || !imageInput || !imagePreview || !dropText) {
                    console.error('One or more required DOM elements are missing:', {
                        dropZone: !!dropZone,
                        imageInput: !!imageInput,
                        imagePreview: !!imagePreview,
                        dropText: !!dropText
                    });
                    return;
                }

                if (typeof selectedFiles === 'undefined') {
                    selectedFiles = [];
                }

                updateDropzoneText();

                ['dragover', 'dragenter'].forEach(event => {
                    dropZone.addEventListener(event, (e) => {
                        e.preventDefault();
                        dropZone.classList.add('drag-over');
                    });
                });

                ['dragleave', 'drop'].forEach(event => {
                    dropZone.addEventListener(event, (e) => {
                        e.preventDefault();
                        dropZone.classList.remove('drag-over');
                    });
                });

                dropZone.addEventListener('click', () => {
                    imageInput.click();
                });

                imageInput.addEventListener('change', (e) => {
                    handleFileSelect(e.target.files);
                });

                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    handleFileSelect(e.dataTransfer.files);
                });

                function handleFileSelect(files) {
                    const newFiles = Array.from(files);

                    // First check if we already have max images
                    if (selectedFiles.length >= MAX_IMAGES) {
                        Swal.fire({
                            title: 'Limit Exceeded',
                            text: `You can upload a maximum of ${MAX_IMAGES} images.`,
                            icon: 'warning',
                            confirmButtonText: 'OK'
                        });
                        return;
                    }

                    // Group files by banner and normal images
                    processFilesInBatch(newFiles);

                    // Check if any files are selected and update validation state
                    if (selectedFiles.length === 0) {
                        dropZone.classList.add('is-invalid');
                        errorContainer.textContent = 'Please upload class images';
                        errorContainer.style.display = 'block';
                    } else {
                        // Remove error state as soon as files are added
                        dropZone.classList.remove('is-invalid');
                        errorContainer.style.display = 'none';
                    }
                }

                async function processFilesInBatch(files) {
                    // Prepare arrays to categorize the files
                    const bannerSizedFiles = [];
                    const normalSizedFiles = [];

                    // First pass: categorize files by size
                    for (const file of files) {
                        try {
                            const dimensions = await getImageDimensions(file);
                            const isBannerSize = dimensions.width === BANNER_DIMENSIONS.width &&
                                dimensions.height === BANNER_DIMENSIONS.height;

                            if (isBannerSize) {
                                bannerSizedFiles.push(file);
                            } else {
                                normalSizedFiles.push(file);
                            }
                        } catch (error) {
                            console.error("Error checking image dimensions:", error);
                        }
                    }


                    // Process banner image first if needed
                    if (!hasBannerImage && bannerSizedFiles.length > 0) {
                        const bannerFile = bannerSizedFiles[0];

                        if (bannerFile.size <= BANNER_MAX_SIZE) {
                            bannerFile.isBanner = true;
                            hasBannerImage = true;
                            selectedFiles.push(bannerFile);

                            // Display single message for extra banner images
                            if (bannerSizedFiles.length > 1) {
                                Swal.fire({
                                    title: 'Invalid Banner Image',
                                    text: `Only using the first banner image. ${bannerSizedFiles.length - 1} additional banner images were not added.`,
                                    icon: 'error',
                                    confirmButtonText: 'OK'
                                });
                            }
                        } else {
                            Swal.fire({
                                title: 'Invalid Banner Image',
                                text: `The banner image must have dimensions of ${BANNER_DIMENSIONS.width}x${BANNER_DIMENSIONS.height}.`,
                                icon: 'error',
                                confirmButtonText: 'OK'
                            });
                        }
                    } else if (hasBannerImage && bannerSizedFiles.length > 0) {
                        Swal.fire({
                            title: 'Invalid Banner Image',
                            text: 'You already have a banner image. Additional banner images were not added.',
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                    }

                    // Process normal images second
                    const normalImagesNeeded = 5 - selectedFiles.filter(f => !f.isBanner).length;

                    if (normalImagesNeeded > 0 && normalSizedFiles.length > 0) {
                        // Only take as many as we need
                        const normalFilesToAdd = normalSizedFiles.slice(0, normalImagesNeeded);

                        // Check size limits for each
                        const validNormalFiles = normalFilesToAdd.filter(file => {
                            if (file.size <= NORMAL_MAX_SIZE) {
                                return true;
                            }
                            return false;
                        });

                        for (const file of validNormalFiles) {
                            file.isBanner = false;
                            selectedFiles.push(file);
                        }

                        // Show message if we rejected some for size
                        const rejectedForSize = normalFilesToAdd.length - validNormalFiles.length;
                        if (rejectedForSize > 0) {
                            Swal.fire({
                                title: 'Invalid Banner Image',
                                text: `${rejectedForSize} normal image(s) exceeded the maximum size of ${NORMAL_MAX_SIZE / 1024 / 1024}MB`,
                                icon: 'error',
                                confirmButtonText: 'OK'
                            });
                        }

                        // Show message if we didn't use all normal files
                        if (normalSizedFiles.length > normalImagesNeeded) {
                            Swal.fire({
                                title: 'Invalid Banner Image',
                                text: `Only using ${normalImagesNeeded} normal images. ${normalSizedFiles.length - normalImagesNeeded} additional normal images were not added.`,
                                icon: 'error',
                                confirmButtonText: 'OK'
                            });
                        }
                    } else if (normalImagesNeeded === 0 && normalSizedFiles.length > 0) {
                        // If we already have max normal images
                        Swal.fire({
                            title: 'Invalid Banner Image',
                            text: 'You already have the maximum number of normal images. Additional normal images were not added.',
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                    }

                    // Update UI after all processing
                    renderPreview();
                    updateFileInput();
                    updateDropzoneText();
                }

                function getImageDimensions(file) {
                    return new Promise((resolve, reject) => {
                        const img = new Image();
                        img.onload = function () {
                            resolve({ width: img.width, height: img.height });
                            // Clean up object URL
                            URL.revokeObjectURL(img.src);
                        };
                        img.onerror = function () {
                            reject(new Error("Failed to load image"));
                            URL.revokeObjectURL(img.src);
                        };
                        img.src = URL.createObjectURL(file);
                    });
                }

                function renderPreview() {
                    imagePreview.innerHTML = '';

                    selectedFiles.forEach((file, index) => {
                        const previewContainer = document.createElement('div');
                        previewContainer.classList.add('image-preview-container');

                        // Add special class for banner
                        if (file.isBanner) {
                            previewContainer.classList.add('banner-image-container');
                        }

                        const img = document.createElement('img');
                        img.classList.add('image-preview-item');
                        img.src = URL.createObjectURL(file);

                        const removeBtn = document.createElement('button');
                        removeBtn.innerHTML = 'Ã—';
                        removeBtn.classList.add('remove-btn');
                        removeBtn.addEventListener('click', () => {
                            // Update hasBannerImage flag if removing banner
                            if (file.isBanner) {
                                hasBannerImage = false;
                            }

                            // Remove the file
                            selectedFiles = selectedFiles.filter(f => f !== file);
                            previewContainer.remove();
                            updateFileInput();
                            updateDropzoneText();
                            validateImages();

                        });

                        const label = document.createElement('span');
                        label.classList.add('image-label');
                        label.textContent = file.isBanner ? 'Banner' : `Image ${index + 1}`;

                        previewContainer.appendChild(img);
                        previewContainer.appendChild(label);
                        previewContainer.appendChild(removeBtn);
                        imagePreview.appendChild(previewContainer);
                    });

                }

                function updateFileInput() {
                    const dataTransfer = new DataTransfer();
                    selectedFiles.forEach(file => dataTransfer.items.add(file));
                    imageInput.files = dataTransfer.files;
                }

                function updateDropzoneText() {
                    const normalImagesCount = selectedFiles.filter(f => !f.isBanner).length;

                    if (selectedFiles.length >= MAX_IMAGES) {
                        // Hide dropzone if we have max images
                        dropZone.style.display = 'none';
                        return;
                    } else {
                        dropZone.style.display = 'block';
                    }

                    if (!hasBannerImage && normalImagesCount < 5) {
                        dropText.textContent = `Drag and drop images or click to select (${selectedFiles.length}/${MAX_IMAGES})
                                    Need: 1 banner image (${BANNER_DIMENSIONS.width}x${BANNER_DIMENSIONS.height}) 
                                    and ${5 - normalImagesCount} normal images`;
                    } else if (!hasBannerImage) {
                        dropText.textContent = `Drag and drop a banner image or click to select (${selectedFiles.length}/${MAX_IMAGES})
                                    Need: 1 banner image (${BANNER_DIMENSIONS.width}x${BANNER_DIMENSIONS.height})`;
                    } else if (normalImagesCount < 5) {
                        dropText.textContent = `Drag and drop normal images or click to select (${selectedFiles.length}/${MAX_IMAGES})
                                    Need: ${5 - normalImagesCount} more normal images`;
                    }
                }
            }

            // Add some CSS for better visualization
            function addCustomStyles() {
                const style = document.createElement('style');
                style.textContent = `
                    .image-preview-container {
                        position: relative;
                        display: inline-block;
                        margin: 10px;
                        border: 2px solid #ddd;
                        border-radius: 4px;
                        overflow: hidden;
                    }
                    .banner-image-container {
                        border-color: #007bff;
                        box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
                    }
                    .image-preview-item {
                        width: 150px;
                        height: 150px;
                        object-fit: cover;
                    }
                    .image-label {
                        position: absolute;
                        bottom: 5px;
                        left: 5px;
                        background-color: rgba(0, 0, 0, 0.7);
                        color: white;
                        padding: 2px 8px;
                        border-radius: 3px;
                        font-size: 12px;
                    }
                    .remove-btn {
                        position: absolute;
                        top: 5px;
                        right: 5px;
                        background-color: rgba(255, 0, 0, 0.7);
                        color: white;
                        border: none;
                        width: 24px;
                        height: 24px;
                        border-radius: 50%;
                        cursor: pointer;
                        font-size: 16px;
                    }
                    .drag-over {
                        background-color: rgba(0, 123, 255, 0.1);
                        border: 2px dashed #007bff;
                    }
                `;
                document.head.appendChild(style);
            }

            addCustomStyles();
            initializeDragAndDrop();


            const $startDate = $('#startDate');
            const $endDate = $('#endDate');
            const $startTime = $('#startTime');
            const $endTime = $('#endTime');

            function validateDateRange() {
                const startDateValue = $startDate.val();
                const endDateValue = $endDate.val();

                $startDate.removeClass('is-invalid is-valid');
                $endDate.removeClass('is-invalid is-valid');
                $startDate.next('.invalid-feedback').text('');
                $endDate.next('.invalid-feedback').text('');

                if (!startDateValue && !endDateValue) {
                    $startDate.addClass('is-invalid').next('.invalid-feedback').text('Start date is required');
                    $endDate.addClass('is-invalid').next('.invalid-feedback').text('End date is required');
                    return false;
                }

                if (!startDateValue) {
                    $startDate.addClass('is-invalid').next('.invalid-feedback').text('Start date is required');
                    return false;
                } else {
                    $startDate.addClass('is-valid');
                }

                if (!endDateValue) {
                    $endDate.addClass('is-invalid').next('.invalid-feedback').text('End date is required');
                    return false;
                } else {
                    $endDate.addClass('is-valid');
                }

                const startDate = new Date(startDateValue);
                const endDate = new Date(endDateValue);

                // Ensure end date is after start date
                if (endDate <= startDate) {
                    $endDate.addClass('is-invalid').next('.invalid-feedback').text('End date must be after start date');
                    return false;
                }

                // Ensure date range is between 2 and 90 days
                const daysDifference = (endDate - startDate) / (1000 * 60 * 60 * 24);
                if (daysDifference > 90) {
                    $endDate.addClass('is-invalid').next('.invalid-feedback').text('Maximum date range is 90 days');
                    return false;
                } else if (daysDifference < 2) {
                    $endDate.addClass('is-invalid').next('.invalid-feedback').text('Minimum date range is 2 days');
                    return false;
                }

                $startDate.addClass('is-valid');
                $endDate.addClass('is-valid');
                return true;
            }

            function validateTimeRange() {
                const startTime = $startTime.val();
                const endTime = $endTime.val();

                $startTime.removeClass('is-invalid');
                $endTime.removeClass('is-invalid');
                $startTime.next('.invalid-feedback').text('');
                $endTime.next('.invalid-feedback').text('');

                if (!startTime && !endTime) {
                    $startTime.addClass('is-invalid').next('.invalid-feedback').text('Start time is required');
                    $endTime.addClass('is-invalid').next('.invalid-feedback').text('End time is required');
                    return false;
                }

                if (!startTime) {
                    $startTime.addClass('is-invalid').next('.invalid-feedback').text('Start time is required');
                    return false;
                }

                if (!endTime) {
                    $endTime.addClass('is-invalid').next('.invalid-feedback').text('End time is required');
                    return false;
                }

                // Convert times to total minutes
                const [startHours, startMinutes] = startTime.split(':').map(Number);
                const [endHours, endMinutes] = endTime.split(':').map(Number);

                const startTotalMinutes = startHours * 60 + startMinutes;
                const endTotalMinutes = endHours * 60 + endMinutes;

                // Ensure end time is after start time
                if (endTotalMinutes <= startTotalMinutes) {
                    $endTime.addClass('is-invalid').next('.invalid-feedback').text('End time must be after start time');
                    return false;
                }

                // Ensure time difference is between 1 and 8 hours
                const timeDiffMinutes = endTotalMinutes - startTotalMinutes;
                if (timeDiffMinutes < 60) {
                    $endTime.addClass('is-invalid').next('.invalid-feedback').text('Minimum duration is 1 hour');
                    return false;
                } else if (timeDiffMinutes > 480) {
                    $endTime.addClass('is-invalid').next('.invalid-feedback').text('Maximum duration is 8 hours');
                    return false;
                }

                return true;
            }

            // Attach event listeners
            $startDate.on('change', validateDateRange);
            $endDate.on('change', validateDateRange);
            $startTime.on('change', validateTimeRange);
            $endTime.on('change', validateTimeRange);

            function validateDescriptions() {
                const description1 = document.getElementById("classDescription");
                const description2 = document.getElementById("classBenefits");
                let isValid = true;

                $(description1).removeClass('is-invalid');
                $(description2).removeClass('is-invalid');

                description1.nextElementSibling.textContent = "";
                description2.nextElementSibling.textContent = "";

                if (!description1.value.trim()) {
                    description1.classList.add("is-invalid");
                    description1.nextElementSibling.textContent = "Description is required.";
                    isValid = false;
                } else if (description1.value.trim().length < 50) {
                    description1.classList.add("is-invalid");
                    description1.nextElementSibling.textContent = "Description must be at least 50 characters.";
                    isValid = false;
                } else if (description1.value.trim().length > 150) {
                    description1.classList.add("is-invalid");
                    description1.nextElementSibling.textContent = "Description cannot exceed 150 characters.";
                    isValid = false;
                }

                if (!description2.value.trim()) {
                    description2.classList.add("is-invalid");
                    description2.nextElementSibling.textContent = "Benefits description is required.";
                    isValid = false;
                } else if (description2.value.trim().length < 150 || description2.value.trim().length > 300) {
                    description2.classList.add("is-invalid");
                    description2.nextElementSibling.textContent = "Benefits description must be between 150 and 300 characters.";
                    isValid = false;
                }

                return isValid;
            }
            document.getElementById("classDescription").addEventListener("input", validateDescriptions);
            document.getElementById("classBenefits").addEventListener("input", validateDescriptions);



            function validateImages() {
                const dropZone = document.getElementById('dropZone');
                let errorContainer = dropZone.parentNode.querySelector('.invalid-feedback');


                if (!errorContainer) {
                    errorContainer = document.createElement('div');
                    errorContainer.className = 'invalid-feedback';
                    dropZone.parentNode.appendChild(errorContainer);
                }

                if (selectedFiles.length !== 6) {
                    dropZone.classList.add('is-invalid');
                    errorContainer.textContent = 'Please upload exactly 6 class images (1 banner + 5 normal images)';
                    errorContainer.style.display = 'block';
                    return false;
                }

                const hasBanner = selectedFiles.some(file => file.isBanner);
                if (!hasBanner) {
                    dropZone.classList.add('is-invalid');
                    errorContainer.textContent = 'Please upload 1 banner image (1920x1080)';
                    errorContainer.style.display = 'block';
                    return false;
                }

                dropZone.classList.remove('is-invalid');
                errorContainer.style.display = 'none';
                return true;
            }

            // Add this to your existing JavaScript
            function validateAddress() {
                const addressInput = document.getElementById('address');
                const addressContainer = addressInput.closest('.input-group');
                const errorFeedback = addressContainer.querySelector('.invalid-feedback');

                if (!addressInput.value.trim()) {
                    addressInput.classList.add('is-invalid');
                    errorFeedback.style.display = 'block';
                    return false;
                }

                addressInput.classList.remove('is-invalid');
                errorFeedback.style.display = 'none';
                return true;
            }


            selectedEquipment = selectedEquipment.map(equip => equip.value).join(", ");

            document.querySelectorAll('input[name="equipment"]').forEach(checkbox => {
                checkbox.addEventListener("change", validateEquipment);
            });






            form.addEventListener("submit", function (e) {

                e.preventDefault();

                const descriptionText = document.getElementById("classDescription").value;
                const descriptionbenefits = document.getElementById("classBenefits").value;

                validateImages();
                const description = {
                    purpose: descriptionText,
                    benefits: descriptionbenefits
                };

                const descriptionJson = JSON.stringify(descriptionText);

                selectedFiles.sort((a, b) => {
                    // Banner image should come first
                    if (a.isBanner) return -1;
                    if (b.isBanner) return 1;
                    return 0;
                });

                if (!form.checkValidity()) {
                    e.stopPropagation();
                    form.classList.add('was-validated');

                    const isTimeValid = validateTimeRange();
                    const isDateValid = validateDateRange();
                    const isDescriptionValid = validateDescriptions();
                    const isImageValid = validateImages();
                    const isAddresValid = validateAddress();

                    @* const isImagesValid = validateImages(); *@

                    if (!isTimeValid || !isDateValid || !isDescriptionValid || !isImageValid || !isAddresValid) {
                        return;
                    }
                    return;
                }



                const equipmentValues = selectedEquipment.map(item => item.value).join(', ');

                let duration = null;
                if (startTimeInput.value && endTimeInput.value) {
                    const start = new Date(`2000-01-01T${startTimeInput.value}`);
                    const end = new Date(`2000-01-01T${endTimeInput.value}`);
                    duration = Math.round((end - start) / (1000 * 60));
                }

                const assets = {
                    images: Array.from(imageInput.files).map(file => ({
                        fileName: file.name,
                        path: imageAssets[file.name]
                    }))
                };

                console.log(assets);

                const formData = new FormData();

                formData.append("classId", "0");
                formData.append("className", document.getElementById("className").value);
                formData.append("instructorId", document.getElementById("instructorId").value);
                formData.append("description", JSON.stringify(description));
                formData.append("type", document.getElementById("classType").value);
                formData.append("startDate", document.getElementById("startDate").value);
                formData.append("endDate", document.getElementById("endDate").value || "");
                formData.append("startTime", startTimeInput.value || "");
                formData.append("endTime", endTimeInput.value || "");
                formData.append("duration", duration ? duration.toString() : "");
                formData.append("maxCapacity", document.getElementById("maxCapacity").value);
                formData.append("requiredEquipments", equipmentValues || "");
                formData.append("createdAt", new Date().toISOString());
                formData.append("status", document.getElementById("status").value);
                formData.append("city", document.getElementById("city").value);
                formData.append("address", document.getElementById("address").value);
                formData.append("assets", JSON.stringify(assets));
                formData.append("fee", document.getElementById("fee").value);

                // Append selected files to formData
                @* for (let i = 0; i < selectedFiles.length; i++) {
                    formData.append(`assetFiles`, selectedFiles[i], selectedFiles[i].name);
                } *@

                    selectedFiles.forEach((file, index) => {
                        formData.append('assetFiles', file);
                        console.log(`Appending file ${index}: ${file.name} (${file.isBanner ? 'Banner' : 'Normal'})`);
                    });

                console.log("Form Data Entries:");
                for (let pair of formData.entries()) {
                    console.log(pair[0] + ':', pair[1]);
                }

                console.log("Files order:");
                for (let [key, value] of formData.entries()) {
                    if (key === 'assetFiles') {
                        console.log(value.name, value.isBanner ? '(Banner)' : '(Normal)');
                    }
                }

                $.ajax({
                    url: 'http://localhost:8080/api/Class/Scheduleclass',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        if (response.success) {
                            console.log('Success:', response.message);
                            Swal.fire({
                                title: 'Success!',
                                text: 'Class scheduled successfully!',
                                icon: 'success',
                                confirmButtonText: 'OK'
                            });
                        } else {
                            Swal.fire({
                                title: 'Error!',
                                text: 'Error Add Class: ' + response.message,
                                icon: 'error',
                                confirmButtonText: 'OK'
                            });
                        }
                    },
                    error: function (xhr, status, error) {
                        let errorMessage = 'An error occurred';
                        try {
                            const response = JSON.parse(xhr.responseText);
                            errorMessage = response.message || errorMessage;
                        } catch (e) {
                            console.error('Error parsing response:', e);
                        }
                        console.error('AJAX Error:', status, error);
                        Swal.fire({
                            title: "Error!",
                            text: "Error Add Class: " + errorMessage,
                            icon: "error",
                            confirmButtonText: "OK",
                        });
                    }
                });

            });



            form.addEventListener("input", function () {
                if (form.classList.contains('was-validated')) {
                    form.classList.remove('was-validated');
                }
            });
        });

    </script>
</body>

</html>