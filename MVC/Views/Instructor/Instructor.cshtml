@{
    ViewData["Title"] = "Instructor";
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instructor Overview</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2023.1.425/js/kendo.all.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --background: #1a1a2e;
            --color: #ffffff;
            --primary-color: #ff4d4d;
            --glass-color: rgba(255, 255, 255, 0.1);
            --success-color: #28a745;
            --danger-color: #dc3545;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: "Poppins", sans-serif;
            background: var(--background);
            color: var(--color);
            letter-spacing: 1px;
            transition: background 0.3s ease;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        a {
            text-decoration: none;
            color: var(--color);
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--primary-color);
        }

        .names-list .list-group-item {
            cursor: pointer;
            transition: background-color 0.3s ease, border-left-color 0.3s ease;
            border-left: 3px solid transparent;
            background: var(--glass-color);
            color: var(--color);
            backdrop-filter: blur(5px);
        }

        .names-list .list-group-item:hover,
        .names-list .list-group-item.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-left-color: var(--primary-color);
            font-weight: 600;
        }

        .details-card {
            background: var(--glass-color);
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            padding: 25px;
            transition: box-shadow 0.3s ease;
            backdrop-filter: blur(15px);
            border: 1px solid hsla(0, 0%, 65%, 0.2);
        }

        .details-card:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }

        .details-section {
            margin-bottom: 20px;
        }

        .details-section h5 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.25rem;
        }

        .detail-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .detail-item strong {
            width: 150px;
            color: rgba(255, 255, 255, 0.7);
            margin-right: 15px;
        }

        .detail-item span {
            flex: 1;
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .document-card {
            background-color: var(--glass-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .document-card:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .document-card i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        #pdf-preview-modal .modal-dialog {
            max-width: 90%;
            height: 90vh;
        }

        #pdf-preview-modal .modal-content {
            height: 100%;
            background: var(--glass-color);
            backdrop-filter: blur(15px);
            border: 1px solid hsla(0, 0%, 65%, 0.2);
            color: var(--color);
        }

        #pdf-viewer-modal {
            height: calc(100% - 60px);
        }

        .btn-success {
            background-color: var(--success-color);
            border: none;
            transition: all 0.3s ease;
        }

        .btn-success:hover {
            background-color: #218838;
            transform: scale(1.03);
        }

        .btn-danger {
            background-color: var(--danger-color);
            border: none;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            background-color: #c82333;
            transform: scale(1.03);
        }

        .bg-light {
            background: var(--glass-color) !important;
            backdrop-filter: blur(5px);
            border: none;
        }

        .text-primary {
            color: var(--primary-color) !important;
        }

        .text-muted {
            color: rgba(255, 255, 255, 0.7) !important;
        }

        .text-secondary {
            color: rgba(255, 255, 255, 0.5) !important;
        }

        /* SweetAlert2 Styles */
        .swal2-popup {
            background: var(--glass-color) !important;
            backdrop-filter: blur(15px) !important;
            border: 1px solid hsla(0, 0%, 65%, 0.2) !important;
            border-radius: 15px !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3) !important;
            color: var(--color) !important;
        }

        .swal2-title {
            color: var(--color) !important;
            font-family: "Poppins", sans-serif !important;
            letter-spacing: 1px !important;
        }

        .swal2-content {
            color: rgba(255, 255, 255, 0.8) !important;
            font-family: "Poppins", sans-serif !important;
        }

        .swal2-confirm {
            background-color: var(--success-color) !important;
            color: var(--color) !important;
            border: none !important;
            border-radius: 8px !important;
            font-family: "Poppins", sans-serif !important;
            transition: all 0.3s ease !important;
        }

        .swal2-confirm:hover {
            background-color: #218838 !important;
            transform: scale(1.03) !important;
        }

        .swal2-cancel {
            background-color: rgba(255, 255, 255, 0.1) !important;
            color: var(--color) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 8px !important;
            font-family: "Poppins", sans-serif !important;
            transition: all 0.3s ease !important;
        }

        .swal2-cancel:hover {
            background-color: rgba(255, 255, 255, 0.2) !important;
            transform: scale(1.03) !important;
        }

        .swal2-icon.swal2-warning {
            color: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
        }

        /* Success Icon (Tick) Styles */
        .swal2-icon.swal2-success {
            border-color: var(--success-color) !important;
            /* Green circle around the success icon */
            background: none !important;
            /* Ensure the container has no background */
        }

        /* Style the success ring (circle) and remove its background */
        .swal2-icon.swal2-success .swal2-success-ring {
            border-color: var(--success-color) !important;
            /* Green circle */
            background: none !important;
            /* Remove the gray background */
            display: block !important;
            /* Ensure the ring is visible for the circle */
        }

        .swal2-icon.swal2-success .swal2-success-circular-line-left,
        .swal2-icon.swal2-success .swal2-success-circular-line-right,
        .swal2-icon.swal2-success .swal2-success-fix  {
            display: none !important;
        }

        
       

        /* Ensure pseudo-elements of the ring don't render a background */
        .swal2-icon.swal2-success .swal2-success-ring::before,
        .swal2-icon.swal2-success .swal2-success-ring::after {
            display: none !important;
            background: transparent !important;
        }

        /* Ensure the success icon container's pseudo-elements don't render a background */
        .swal2-icon.swal2-success::before,
        .swal2-icon.swal2-success::after {
            display: none !important;
            background: transparent !important;
        }

        /* Style the checkmark lines */
        .swal2-icon.swal2-success [class^='swal2-success-line'] {
            background-color: var(--success-color) !important;
            /* Green checkmark */
        }

        /* Profile Image Styling */
        .profile-image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .profile-image {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            transition: transform 0.3s ease;
        }

        .profile-image:hover {
            transform: scale(1.05);
        }

        .personal-info-row {
            display: flex;
            align-items: center;
            min-height: 180px;
        }

        /* Ensure proper alignment of personal info */
        .personal-info-details {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .personal-info-column {
            flex: 1;
            min-width: 200px;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Left Panel (25%) - Instructor Names -->
            <div class="col-md-3 p-3 border-end bg-light">
                <h5 class="text-primary mb-3">Instructors</h5>
                <div class="names-list">
                    <ul class="list-group" id="names"></ul>
                </div>
            </div>

            <!-- Right Panel (75%) - Instructor Details -->
            <div class="col-md-9 p-4">
                <div id="default-message" class="text-center text-muted mt-5">
                    <h4>Select an instructor to view details</h4>
                    <p class="text-secondary">Choose a name from the list to see more information</p>
                </div>
                <div id="details" class="d-none details-card">
                    <!-- Personal Information Section -->
                    <div class="details-section">
                        <h5>Personal Information</h5>
                        <div class="row personal-info-row">
                            <div class="col-md-8 personal-info-details">
                                <div class="personal-info-column">
                                    <div class="detail-item"><strong>Name:</strong> <span id="name"></span></div>
                                    <div class="detail-item"><strong>Email:</strong> <span id="email"></span></div>
                                    <div class="detail-item"><strong>Mobile:</strong> <span id="phone"></span></div>
                                    <div class="detail-item"><strong>Gender:</strong> <span id="gender"></span></div>
                                    <div class="detail-item"><strong>Date of Birth:</strong> <span id="dob"></span>
                                    </div>
                                    <div class="detail-item"><strong>Association:</strong> <span
                                            id="association"></span></div>
                                    <div class="detail-item"><strong>Status:</strong> <span id="status"></span></div>
                                </div>
                            </div>
                            <div class="col-md-4 profile-image-container">
                                <img id="profile-image" class="profile-image" src="" alt="Profile Image"
                                    onerror="handleImageError(this)">
                            </div>
                        </div>
                    </div>

                    <!-- Professional Information Section -->
                    <div class="details-section">
                        <h5>Professional Details</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="detail-item"><strong>Specialization:</strong><span
                                        id="specialization"></span></div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item"><strong>Certifications:</strong><span
                                        id="certifications"></span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Section -->
                    <div class="details-section">
                        <h5>Documents</h5>
                        <div class="documents-grid" id="documents-grid">
                            <!-- Document cards will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Approval Section -->
                    <div class="details-section">
                        <h5>Approval Status</h5>
                        <div class="d-flex gap-3">
                            <button id="approve-btn" class="btn btn-success"
                                onclick="approveInstructor()">Approve</button>
                            <button id="disapprove-btn" class="btn btn-danger"
                                onclick="disapproveInstructor()">Disapprove</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PDF Preview Modal -->
        <div class="modal fade" id="pdf-preview-modal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="document-title">PDF Preview</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-0">
                        <div id="pdf-viewer-modal" class="w-100 h-100">
                            <iframe src="" width="100%" height="100%" frameborder="0"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const apiBaseUrl = "http://localhost:8080/api/Instructor/";
        let currentInstructorId = null;

        // Function to handle image load error
        function handleImageError(img) {
            img.src = '/images/placeholder.jpg'; // Local fallback image
            img.onerror = null; // Prevent infinite loop
        }

        // Load Instructor List
        function loadInstructorList() {
            $.ajax({
                url: apiBaseUrl,
                method: "GET",
                success: function (response) {
                    let html = response.data.map(instructor => `
                        <li class="list-group-item" data-id="${instructor.instructorId}" onclick="selectInstructor(${instructor.instructorId})">
                            ${instructor.instructorName}
                        </li>
                    `).join('');
                    $('#names').html(html);
                },
                error: function () {
                    console.error("Error loading instructors.");
                }
            });
        }

        // Select Instructor and Show Details
        function selectInstructor(instructorId) {
            $.ajax({
                url: `${apiBaseUrl}GetOneInstructor/${instructorId}`,
                method: "GET",
                success: function (response) {
                    const instructor = response.data;
                    currentInstructorId = instructorId;

                    $('#names .list-group-item').removeClass('active');
                    $(`#names .list-group-item[data-id='${instructorId}']`).addClass('active');

                    $('#default-message').addClass('d-none');
                    $('#details').removeClass('d-none');

                    // Populate instructor details
                    $('#name').text(instructor.instructorName || 'N/A');
                    $('#email').text(instructor.email || 'N/A');
                    $('#phone').text(instructor.mobile || 'N/A');
                    $('#gender').text(instructor.gender || 'N/A');
                    $('#dob').text(instructor.dob ? new Date(instructor.dob).toLocaleDateString() : 'N/A');
                    $('#association').text(instructor.association || 'N/A');
                    $('#status').text(instructor.status || 'N/A');
                    $('#specialization').text(instructor.specialization || 'N/A');

                    // Set profile image
                    const profileImage = $('#profile-image');
                    if (instructor.profileImage) {
                        profileImage.attr('src', `/documents/${instructor.profileImage}`);
                    } else {
                        profileImage.attr('src', '/images/placeholder.jpg');
                        profileImage[0].onerror = null;
                    }

                    // Handle certifications safely
                    let certifications = 'N/A';
                    if (instructor.certificates) {
                        if (instructor.certificates.certifications) {
                            certifications = instructor.certificates.certifications.join(', ');
                        } else {
                            certifications = Object.keys(instructor.certificates).join(', ');
                        }
                    }
                    $('#certifications').text(certifications);

                    // Populate documents grid dynamically
                    const documentsGrid = $('#documents-grid');
                    documentsGrid.empty(); // Clear previous content

                    // ID Proof
                    if (instructor.idProof) {
                        documentsGrid.append(`
                            <div class="document-card" onclick="viewPDF('/documents/${instructor.idProof}', 'ID Proof')">
                                <i class="bi bi-credit-card"></i>
                                <h6 class="mb-0">ID Proof</h6>
                            </div>
                        `);
                    }

                    // Certificates
                    if (instructor.certificates) {
                        const certs = instructor.certificates.certifications || Object.values(instructor.certificates);
                        const certKeys = instructor.certificates.certifications || Object.keys(instructor.certificates);
                        certs.forEach((cert, index) => {
                            if (typeof cert === 'string' && (cert.includes('.pdf') || cert.includes('.jpg') || cert.includes('.png'))) {
                                const certKey = certKeys[index] || `Certificate ${index + 1}`;
                                documentsGrid.append(`
                                    <div class="document-card" onclick="viewPDF('/documents/${cert}', '${certKey}')">
                                        <i class="bi bi-trophy"></i>
                                        <h6 class="mb-0">${certKey}</h6>
                                    </div>
                                `);
                            }
                        });
                    }
                },
                error: function () {
                    console.error("Error fetching instructor details.");
                }
            });
        }

        // Approve Instructor with Swal.fire
        function approveInstructor() {
            if (!currentInstructorId) {
                Swal.fire("Error", "Please select an instructor first.", "error");
                return;
            }

            Swal.fire({
                title: "Are you sure?",
                text: "Do you want to approve this instructor?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Yes, Approve",
                cancelButtonText: "Cancel"
            }).then((result) => {
                if (result.isConfirmed) {
                    console.log(`Instructor ${currentInstructorId} approved.`);
                    Swal.fire({
                        title: "Success",
                        text: "Instructor approved successfully!",
                        icon: "success",
                        confirmButtonText: "OK"
                    });
                }
            });
        }

        // Disapprove Instructor with Swal.fire
        function disapproveInstructor() {
            if (!currentInstructorId) {
                Swal.fire("Error", "Please select an instructor first.", "error");
                return;
            }

            Swal.fire({
                title: "Are you sure?",
                text: "Do you want to disapprove this instructor?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Yes, Disapprove",
                cancelButtonText: "Cancel"
            }).then((result) => {
                if (result.isConfirmed) {
                    console.log(`Instructor ${currentInstructorId} disapproved.`);
                    Swal.fire({
                        title: "Success",
                        text: "Instructor disapproved successfully!",
                        icon: "success",
                        confirmButtonText: "OK"
                    });
                }
            });
        }

        // View PDF in Modal
        function viewPDF(pdfUrl, title) {
            $('#document-title').text(title);
            $('#pdf-viewer-modal iframe').attr('src', pdfUrl);
            new bootstrap.Modal('#pdf-preview-modal').show();
        }

        // Load instructor list on page load
        $(document).ready(function () {
            loadInstructorList();
        });
    </script>
</body>

</html>